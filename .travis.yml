---
#
# Ansible managed
#
language: python

os: linux
dist: xenial

python:
  - "3.9"

services:
  - docker

env:
  global:
    namespace="robertdebock"
  jobs:
    - image="centos" tag="7"
    - image="centos" tag="latest"
    - image="opensuse" tag="latest"

cache:
  - pip

install:
  - pip install --upgrade pip
  - pip install tox

script:
  - function retry { counter=0 ; until "$@" ; do exit=$? ; counter=$(($counter + 1)) ; if [ $counter -ge 3 ] ; then return $exit ; fi ; done ; return 0; } ; retry tox

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
  slack:
    secure: "tGHICszg8lh54LC9gAON3VZlBSdSc4v3HK/BHBChRW063C6LM+HVrCsmKBL+B6eYBJYvYKRvaacGmlJNteriOYMY4QsvO0bofR32w0XUZsz1SMkIp/3WiPpT50CVobJ3XKBxC+kNv+nIMDmY7cTgg+/0v+gLTJx2X3lpabNpNEwwSfQCrI1VAqBS0hd6m2+y1p6fyTdEk1G1G2cTeAt7OGwIrGXQpQEuP8zzletAtoTmHWmh7gFQmYeVozdi5dsQ+kxutCtOLi//wT4DFvzmSbhCsGng2a5wV9MMpymITS/fw7wVVqaBc/DamCl458QKNebO3Q+eaoKp58xY55y0DqPapw7IgkcA6D4lHAJ4REZMBCk0IjDZBsp9+bNriCdMSudPwLNuk3MjkNOnWP3vOnQ1tDGGr7vRa803ZtxdrOv2u+hTn86X7OVPtoKLdWi1uoYLOQh9oepZnjBEQwYBCaSwd9lr33ebwZR4p47pSlJHmKfcwVpaLQ/SvlU+aPWPC1yuZNhglT+uv7ayqtF8I6hmmD9VZar1EYHkPh/g4cvYrqZiQaZ7sdXjvhtVchv2S+S2x+8LdEE9agHaJYTM8MGN1e45wAG1fslmoUqoxaCk6jc0CfpEK0SvBFOMiDap+eLrV2bbjFvysnBMlTkV02fr+Gmo83IW8qac2XpjNwo="
    on_success: change
    template: "%{result}: %{repository_slug}@%{branch}, build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>)"
  email: false
